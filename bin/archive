#!/usr/bin/env sh

set -e
readonly PROJECT_ROOT="$(dirname "$0")/.."

# shellcheck source=lib/archive/constants.sh
. "${PROJECT_ROOT}/lib/archive/constants.sh"

# shellcheck source=lib/archive/parse_options.sh
. "${PROJECT_ROOT}/lib/archive/parse_options.sh"

# shellcheck source=lib/archive/manage_archive.sh
. "${PROJECT_ROOT}/lib/archive/manage_archive.sh"

# shellcheck source=lib/archive/informative.sh
. "${PROJECT_ROOT}/lib/archive/informative.sh"

# shellcheck source=lib/archive/help.sh
. "${PROJECT_ROOT}/lib/archive/help.sh"


# ==================
#  Main entry point
# ==================


# Sets $action, $file, $remove_files
if ! parse_options "$@"; then
  usage
  exit 1
fi

case "${action}" in
  "${ACTION_ADD}") 
    add_to_archive "${file}" "${remove_files}" 
    ;;
  "${ACTION_UNARCHIVE}") 
    unarchive "${file}" "${remove_files}" 
    ;;
  "${ACTION_LIST}") 
    # shellcheck disable=SC2119
    list 
    ;;
  "${ACTION_TOP_LEVEL_LIST}")
    # shellcheck disable=SC2119
    list_top_level
    ;;
  "${ACTION_HELP}") help ;;
  "${ACTION_VERSION}") usage ;;
  *) 
    usage
    exit 1 ;;
esac
